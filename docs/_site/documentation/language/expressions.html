<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <img src="/malloy/img/logo.png" alt="malloy logo"/>Malloy <span class="subtitle">Documentation</span>
      </div>
      <div class="main">
        <div class="sidebar">
    <div>
        <div class="sidebar-section-title">Getting Started</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/index.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Tao of Malloy
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/features.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Key Features
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Language Reference</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/language/overview.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Introduction
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/basic.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Basics
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/statement.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Models
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/query.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Queries
            </a>
          </div>
<div class='sidebar-item active'>
            <a href="/malloy/documentation/language/expressions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Expressions
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/order_by.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Ordering and Limiting
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/shape.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Shape Definition
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/join.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Joins
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/filters.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Filters
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/filter_expressions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Filter Syntax
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/time-ranges.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Time Ranges
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/turtle.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Turtles
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/imports.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Imports and Exports
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/apply.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Apply Operator
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Common Patterns</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/yoy.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Year Over Year Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/foreign_sums.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Foreign Sums and Averages
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/percent_of_total.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Percent of Total
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/cohorts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Cohort Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/pivot_limits.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Pivot Limits
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/sessionize.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Sessionized Data
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Visualizations</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/bar_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bar Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/charts_line_chart.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Line Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/shape_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Shape Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/segment_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Segment Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/scatter_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Scatter Charts
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Examples</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ecommerce.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              eCommerce Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/faa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              NTSB Flight Database
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/names.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Name Game
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ga_sessions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Google Analytics GA360
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Iowa Liquor - An Analysis</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/iowa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              About the Data Set
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/source.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Malloy Data Model
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Basic Calculations
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2a.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Analysis: Products and Brands
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step3.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bucketing and Mapping
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step6.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Dashboards
            </a>
          </div>
      </div>

  </div>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="query.html"><img src="/malloy/img/previous.svg" alt="previous"/>Queries</a>
    </div>
    <div class="item">
      <a href="order_by.html">Ordering and Limiting<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="expressions" class="header-link anchor" href="#expressions">
          Expressions
        </a>
      </h1>
    <p>Expressions in Malloy are much like expressions in any other computer
language; they can have variables and operators and function calls in
the same syntax users are familiar with.</p>
<p>To support the task of data transformation and constructing a data model,
Malloy expressions provide the below syntax:</p>
<table>
<thead>
<tr>
<th>Syntax</th>

<th>Example(s)</th>

<th>Section</th>
</tr>
</thead>
<tbody><tr>
<td><em>expr</em> <code class="language-malloy">:</code> <code class="language-malloy"><span class="token punctuation">[</span></code> <em>filterList</em> <code class="language-malloy"><span class="token punctuation">]</span></code></td>

<td><code class="language-malloy"><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : <span class="token punctuation">[</span>state:<span class="token string">'ca'</span><span class="token punctuation">]</span></code></td>

<td><a href="filters.html">Filtered</a> Sub Expression</td>
</tr>

<tr>
<td><em>expr</em> <code class="language-malloy">::</code> <em>type</em></td>

<td><code class="language-malloy">table<span class="token punctuation">.</span>col::<span class="token type">string</span></code></td>

<td>Safe Type Cast</td>
</tr>

<tr>
<td><em>expr</em> <code class="language-malloy"><span class="token keyword">to</span></code> <em>expr</em></td>

<td><code class="language-malloy"><span class="token number">1</span> <span class="token keyword">to</span> <span class="token number">100</span></code></td>

<td>Range</td>
</tr>

<tr>
<td><em>timeExpr</em> <code class="language-malloy"><span class="token keyword">for</span></code> <em>nExpr</em> <em>timeframe</em></td>

<td><code class="language-malloy">event<span class="token punctuation">.</span>startAt <span class="token keyword">for</span> <span class="token number">3</span> <span class="token timeframe">hours</span></code></td>

<td><a href="time-ranges.html">Duration Time Ranges</a></td>
</tr>

<tr>
<td><em>compareOperator</em> <em>expr</em></td>

<td><code class="language-malloy"><span class="token operator">></span> <span class="token number">42</span></code></td>

<td>Partial Comparison</td>
</tr>

<tr>
<td><em>exprOrPartial</em>  <code class="language-malloy"><span class="token operator">&amp;</span></code> <em>exprOrPartial</em></td>

<td><code class="language-malloy"><span class="token punctuation">(</span><span class="token operator">></span><span class="token number">5</span> <span class="token operator">&amp;</span> <span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span></code>, <code class="language-malloy"><span class="token punctuation">(</span><span class="token string">'red'</span> <span class="token operator">&amp;</span> <span class="token string">'blue'</span><span class="token punctuation">)</span></code></td>

<td>Alternation</td>
</tr>

<tr>
<td><em>exprOrPartial</em>  <code class="language-malloy"><span class="token operator">|</span></code> <em>exprOrPartial</em></td>

<td><code class="language-malloy"><span class="token punctuation">(</span><span class="token operator">></span><span class="token number">5</span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span></code>, <code class="language-malloy"><span class="token punctuation">(</span><span class="token string">'red'</span> <span class="token operator">|</span> <span class="token string">'blue'</span><span class="token punctuation">)</span></code></td>

<td>Alternation</td>
</tr>

<tr>
<td><em>expr</em> <code class="language-malloy">:</code> <em>exprOrPartial</em></td>

<td><code class="language-malloy">weight: <span class="token operator">></span><span class="token number">100</span> <span class="token operator">&amp;</span> <span class="token operator">&lt;</span> <span class="token number">1000</span></code></td>

<td><a href="apply.html">Apply</a></td>
</tr>

<tr>
<td><em>fieldName.aggregate()</em></td>

<td><code class="language-malloy">aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span>seats<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></td>

<td>Asymmetric Aggregation</td>
</tr>

<tr>
<td><code class="language-malloy"><span class="token keyword">pick</span></code> <em>expr</em> <code class="language-malloy"><span class="token keyword">when</span></code> <em>exprOrPartial</em> <br>...<br><code class="language-malloy"><span class="token keyword">else</span></code> <em>expr</em> <em>(optional</em>)</td>

<td><code class="language-malloy"><span class="token keyword">pick</span> <span class="token string">'small'</span> <span class="token keyword">when</span> size <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">`</span><span class="token operator">&lt;</span>br<span class="token operator">></span><span class="token punctuation">`</span><span class="token keyword">pick</span> <span class="token string">'medium'</span> <span class="token keyword">when</span> size <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">`</span><span class="token operator">&lt;</span>br<span class="token operator">></span><span class="token punctuation">`</span><span class="token keyword">else</span> <span class="token string">'large'</span></code> <br> OR <br><code class="language-malloy">size:</code> <br> <code class="language-malloy">  <span class="token keyword">pick</span> <span class="token string">'small'</span> <span class="token keyword">when</span> <span class="token operator">&lt;</span> <span class="token number">10</span></code><br><code class="language-malloy">    <span class="token keyword">pick</span> <span class="token string">'medium'</span> <span class="token keyword">when</span> <span class="token operator">&lt;</span> <span class="token number">20</span></code><br><code class="language-malloy">    <span class="token keyword">else</span> <span class="token string">'large'</span></code></td>

<td><a href="pick-expressions.html">Pick Expressions</a></td>
</tr>

<tr>
<td><code class="language-malloy"><span class="token date">@</span></code><em>timespec</em></td>

<td><code class="language-malloy"><span class="token date">@2016</span></code>  , <code class="language-malloy"><span class="token date">@2020-01-13</span></code> , <code class="language-malloy"><span class="token date">@2020-00-01 00:00</span></code></td>

<td><a href="time-ranges.html#literals">Date Literals</a></td>
</tr>

<tr>
<td><em>timeValue</em>.<em>truncation</em></td>

<td><code class="language-malloy">eventTime<span class="token punctuation">.</span><span class="token timeframe">quarter</span></code> , <code class="language-malloy">flightTime<span class="token punctuation">.</span><span class="token timeframe">year</span></code></td>

<td><a href="time-ranges.html#truncation">Time Truncation</a></td>
</tr>
</tbody></table>
<br>
      <h1>
        <a id="sql-functions" class="header-link anchor" href="#sql-functions">
          SQL functions
        </a>
      </h1>
    <p>The intention is to be able to call from Malloy any function which
you could call from Standard SQL. This is not well implemented at
the moment. If you experience type check errors, use the <code class="language-malloy">::type</code>
typecast to work around the errors in typing.</p>
</div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>